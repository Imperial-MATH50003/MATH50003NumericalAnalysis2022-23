# MATH50003 Numerical Analysis (2022‚Äì23)
# Problem Sheet 3

This problem sheet explores the error in using divided differences. 

Please complete the problems using pen-and-paper, though some can be verified using Julia.

-------


**Problem 1.1** Use Taylor's theorem to derive an error bound for central differences
$$
f'(x) ‚âà {f(x + h) - f(x - h) \over 2h}.
$$
in terms of 
$$
M = \max_{y ‚àà [x-h,x+h]}\left| f'''(y)\right|.
$$

**SOLUTION**


By Taylor's theorem, the approximation around $x+h$ is
$$f(x+h) = f(x) + f'(x)h + \frac{f''(x)}{2}h^2 + \frac{f'''(z_1)}{6}h^3,$$
for some $z_1 ‚àà (x, x+h)$ and similarly
$$f(x-h) = f(x) + f'(x)(-h) + \frac{f''(x)}{2}h^2 - \frac{f'''(z_2)}{6}h^3,$$
for some $z_2 ‚àà (x-h, x)$.

Subtracting the second expression from the first we obtain
$$f(x+h)-f(x-h) = f'(x)(2h) + \frac{f'''(z_1)+f'''(z_2)}{6}h^3.$$
Hence,

$$ \frac{f(x+h)-f(x-h)}{2h} = f'(x)  + \underbrace{\frac{f'''(z_1)+f'''(z_2)}{12}h^2}_{Œ¥_{\rm Taylor}}.$$

Thus, the error can be bounded by
$$\left|Œ¥_{\rm Taylor}\right| ‚â§ {M \over 6} h^2,$$
where
$$
M=\max_{y ‚àà [x-h,x+h]}\left| f'''(y)\right|.
$$

**END**

**Problem 1.2**
Find an error bound when implemented in floating point arithmetic, assuming that
$$f^{\rm FP}(x) = f(x) + \delta_x$$
where $|\delta_x| \leq c œµ_{\rm m}$. You may assume all operations result in numbers
in the normalised range.

**SOLUTION**

In floating point we have 
$$
\begin{align*}
(f^{\rm FP}(x + 2h) ‚äñ f^{\rm FP}(x-2h)) ‚äò (2h) &= {f(x + h) +  Œ¥_{x+h} - f(x-h) - Œ¥_{x-h} \over 2h} (1 + Œ¥_1) \\
&= {f(x+h) - f(x-h) \over 2h} (1 + Œ¥_1) + {Œ¥_{x+h}- Œ¥_{x-h} \over 2h} (1 + Œ¥_1)
\end{align*}
$$
Applying Taylor's theorem we get 
$$
(f^{\rm FP}(x + h) ‚äñ f^{\rm FP}(x-h)) ‚äò (2h) = 
f'(x) + \underbrace{f'(x) Œ¥_1 + Œ¥_{\rm Taylor} (1 + \delta_1) + {Œ¥_{x+h}- Œ¥_{x-h} \over 2h} (1 + Œ¥_1)}_{Œ¥_{x,h}^{\rm CD}}
$$
where
$$
|Œ¥_{x,h}^{\rm CD}| ‚â§ {|f'(x)| \over 2} œµ_{\rm m} + {M \over 3} h^2 + {2 c œµ_{\rm m} \over h}
$$

**END**


**Problem 1.3**
Derive the error for central differences exactly for the different cases to explain the observed behaviour.

**SOLUTION**

To compute the errors of the central difference approximation of $f'(x)$ we compute
$$
\begin{align*}
\left| \frac{f(x+h)-f(x-h)}{2h} - f'(x) \right|
&=\left| \frac{1 + (x+h) + (x+h)^2 - 1 - (x-h) - (x-h)^2}{2h} - (1+2x)\right| \\
&=\left| \frac{2h + 4hx}{2h} - 1 -2x\right| = 0.
\end{align*}
$$
As we can see, in this case the central difference approximation is exact. 
The errors we start observing for small step sizes are thus numerical in nature. 
The values of the function at $f(x+h)$ and $f(x-h)$ eventually become numerically indistinguishable 
and thus this finite difference approximation to the derivative incorrectly results in $0$.


To compute the errors of the central difference approximation of $g'(x)$ we compute

$$
\begin{align*}
\left| \frac{g(x+h)-g(x-h)}{2h} - g'(x) \right|&= \left| \frac{1 + \frac{(x+h)}{3} + (x+h)^2 - 1 - \frac{(x-h)}{3} - (x-h)^2}{2h} - \left(\frac{1}{3}+2x \right)\right| \\
&=\left| \frac{1}{3} + 2x - \frac{1}{3} - 2x\right| = 0.
\end{align*}
$$
**END**


-----

**Problem 2.1** Use Taylor's theorem to derive an error bound on the second-order derivative approximation
$$
f''(x) ‚âà {f(x+h) - 2f(x) + f(x-h) \over h^2}
$$
in terms of 
$$
M = \max_{y‚àà[x-h,x+h]}\left|f'''(y)\right|.
$$

**SOLUTION**
Using the same two formulas as in 1.1 we have
$$f(x+h) = f(x) + f'(x)h + \frac{f''(x)}{2}h^2 + \frac{f'''(z_1)}{6}h^3,$$
for some $z_1 ‚àà (x, x+h)$
and
$$f(x-h) = f(x) + f'(x)(-h) + \frac{f''(x)}{2}h^2 - \frac{f'''(z_2)}{6}h^3,$$
for some $z_2 ‚àà (x-h, x)$.

Summing the two we obtain
$$f(x+h) + f(x-h) = 2f(x) + f''(x)h^2 + \frac{f'''(z_1)}{6}h^3 - \frac{f'''(z_2)}{6}h^3.$$

Thus,
$$f''(x) = \frac{f(x+h) - 2f(x) + f(x-h)}{h^2} + \frac{f'''(z_2) - f'''(z_1)}{6}h.$$

Hence, the error is 
$$
\left|f''(x) - \right| = \left|\frac{f'''(z_2) - f'''(z_1)}{6}h\right|‚â§ 2Ch ,
$$
where again
$$C = \max_{y‚àà[x-h,x+h]}\left|\frac{f'''(y)}{6}\right|.$$
**END**

**Problem 2.2** Find an error bound when implemented in floating point arithmetic, assuming that
$$
f^{\rm FP}(x) = f(x) + Œ¥_x
$$
where $|Œ¥_x| \leq c œµ_{\rm m}$.

**SOLUTION**

In floating point arithmetic we assume $x + h = x ‚äï h$, $h$ is a power of $2$ and all computations are normal. 
Then we have:
$$
f^{\rm FP}(x + h) ‚äñ 2f^{\rm FP}(x) = (f(x+h) + Œ¥_{x+h} - 2f(x) -2Œ¥_x)(1+Œ¥^1) = f(x+h) - 2f(x) + \underbrace{(f(x+h) - 2f(x))Œ¥^1 + (Œ¥_{x+h} - 2 Œ¥_x)(1+Œ¥^1)}_{Œ¥^2}
$$
where $|Œ¥^2| ‚â§¬†(3/2F + 4c) œµ_m$, where $F = \sup_{x-h ‚â§ t ‚â§¬†x+h} |f(t)|$. Therefore
$$
(f^{\rm FP}(x + h) ‚äñ 2f^{\rm FP}(x)) ‚äï f^{\rm FP}(x - h) = ((f(x+h) - 2f(x) + Œ¥^2) + f(x-h) + Œ¥_{x-h})(1+Œ¥^3) = f(x+h) - 2f(x) + f(x-h) + \underbrace{(f(x+h) - 2f(x) + f(x-h)) Œ¥^3 + (Œ¥^2 + Œ¥_{x-h})(1+Œ¥^3)}_{Œ¥^4}
$$
where $|Œ¥^4| ‚â§ (5F + 10c)œµ_{\rm m}$. Putting everything together we have
$$
{(f^{\rm FP}(x + h) ‚äñ 2f^{\rm FP}(x)) ‚äï f^{\rm FP}(x - h) \over h} = {f(x+h) - 2f(x) + f(x-h) \over h^2} + {Œ¥^4 \over h^2} = f''(x) + \frac{f'''(z_2) - f'''(z_1)}{6}h +  {Œ¥^4 \over h^2} 
$$
that is the error is bounded by
$$
2Ch + (5F + 10c){œµ_{\rm m} \over h^2}
$$

**END**

-----

**Problem 3.1** 
Show that dual numbers $ùîª$ are a _commutative ring_, that is, for all $a,b,c ‚àà ùîª$ the following are satisfied:
1. _additive associativity_: $(a + b) + c = a + (b + c)$
2. _additive commutativity_: $a + b = b + a$
3. _additive identity_: There exists $0 ‚àà ùîª$ such that $a + 0 = a$.
4. _additive inverse_: There exists $-a$ such that $(-a) + a = 0$.
5. _multiplicative associativity_: $(ab)c = a(bc)$
6. _multiplictive commutativity_: $ab = ba$
7. _multiplictive identity_: There exists $1 ‚àà ùîª$ such that $1a= a$.
8. _distributive_: $a(b+c) = ab + ac$

**SOLUTION**
In what follows we write $a = a_r + a_d œµ$ and likewise for $b,c ‚àà ùîª$.

Additive associativity and commutativity and existence of additive inverse are both 
immediate results of dual number addition reducing to element-wise real number addition. 
Furthermore, by definition of addition on $ùîª$ the dual number $0+0 œµ$ acts as the additive 
identity since
$$
(a_r+a_dœµ)+(0+0œµ) = (a_r+a_dœµ ).
$$
We explicitly prove multiplicative commutativity
$$
ab = (a_r+a_dœµ )(b_r+b_d œµ ) = a_r b_r+(a_r b_d+a_d b_r)œµ = b_r a_r+(b_r a_d+b_d a_r)œµ = ba.
$$
We also explicitly prove multiplicative associativity:
$$
(ab)c = ((a_r b_r+(a_r b_d+a_d b_r) œµ ) c = 
a_r b_r c_r + ((a_r b_d + a_d b_r) c_r  + a_r b_r c_d) œµ = 
a_r b_r c_r + (a_r b_d c_r + a_d b_r c_r  + a_r b_r c_d) œµ
$$
and
$$
a(bc) = a ((b_r c_r+(b_r c_d+b_d c_r) œµ ) = a_r b_r c_r + (a_r b_d c_r + a_d b_r c_r  + a_r b_r c_d) œµ.
$$
The number $1+0œµ$ serves as the multiplicative identity. Note that for any dual number $a$, we have
$$
(1+0œµ )(a_r + a_d œµ ) = 1 a_r + (a_r 0 + 1 a_d) œµ = a_r+a_d œµ = a.
$$
Finally we show distributivity of multiplication:
$$
a(b+c) = a (b_r+c_r + (b_d+c_d)œµ) = (a_r b_r + a_r c_r) + (a_r b_d+a_r c_d+ a_d b_r + a_d c_r) œµ,
$$
$$
ab + ac = a_r b_r + (a_d b_r + a_r b_d) œµ + a_r c_r + (a_d c_r + a_r c_d) œµ = (a_r b_r + a_r c_r) + (a_r b_d+a_r c_d+ a_d b_r + a_d c_r) œµ.
$$

**END**

**Problem 3.2 (C)** A _field_ is a commutative ring such that $0 ‚â† 1$ and all nonzero elements have a multiplicative inverse, i.e.,
there exists $a^{-1}$ such that $a a^{-1} = 1$. Why isn't $ùîª$ a field?

**SOLUTION**

Fields require that all nonzero elements have a unique multiplicative inverse. However, this is not the case for dual numbers. To give an explicit counter example, we show that there is no dual number $z$ which is the inverse of $0+œµ$, i.e. a dual number $z$ such that
$$
\frac{(0+œµ)}{(z_r+z_d œµ)} = 1 + 0 œµ.
$$
By appropriate multiplication with the conjugate we show that
$$
\frac{(0+œµ)(z_r-z_d œµ)}{(z_r+z_d œµ)(z_r-z_d œµ)} = \frac{z_r œµ}{z_r^2} = \frac{œµ}{z_r}.
$$
This proves that no choice of real part $z_r$ can reach the multiplicative identity $1+0 œµ$ when starting from the number $0+œµ$. More general results for zero real part dual numbers can also be proved.

**END**
 

-----

**Problem 4** A _matrix representation_ of a ring are maps from a group/ring to matrices such that matrix addition and multiplication
behave exactly like addition and multiplication of the ring. 
That is, if $A$ and $B$ are elements of the ring and $œÅ$ is a representation, then
$$
œÅ(A + B) = œÅ(A) + œÅ(B) \hbox{ and } œÅ(AB) = œÅ(A)œÅ(B).
$$
Show that the following are matrix representations of complex numbers and dual numbers (respectively):
$$
\begin{align*}
œÅ_{\rm c}(a + b {\rm i}) &= \begin{pmatrix} a & b \\ -b & a \end{pmatrix}, \\
œÅ_œµ(a + b {\rm œµ}) &= \begin{pmatrix} a & b \\ 0 & a \end{pmatrix}.
\end{align*}
$$

**SOLUTION**

Let $A = a+bi$ and $B=c+di$ and $œÅ$ be the map to their proposed matrix representations. First we check that addition complies with addition of complex numbers, that is 
$(a+bi)+(c+di) = (a+c)+(b+d)i:$
 
$œÅ(A) + œÅ(B) = \begin{pmatrix} a & b \\ -b & a \end{pmatrix} + \begin{pmatrix} c & d \\ -d & c \end{pmatrix} = \begin{pmatrix} a+c & b+d \\ -(b+d) & a+c \end{pmatrix} = œÅ(A+B).$

Next for multiplication we need $(a+bi)(c+di) = (ac-bd)+(bc+ad)i $:

$œÅ(A)œÅ(B) = \begin{pmatrix} a & b \\ -b & a \end{pmatrix}\begin{pmatrix} c & d \\ -d & c \end{pmatrix} = \begin{pmatrix} ac-bd & bc+ad \\ -(bc+ad) & ac-bd \end{pmatrix} = œÅ(AB)$

Now we move on to dual numbers $A = a+b œµ $ and $B=c+d œµ$ and their matrix representation map $œÅ_œµ$: For addition of dual numbers $(a+bœµ )+(c+dœµ ) = (a+c) + (b+d) œµ$:

$œÅ_œµ(A) + œÅ_œµ(B) = \begin{pmatrix} a & b \\ 0 & a \end{pmatrix} + \begin{pmatrix} c & d \\ 0 & c \end{pmatrix} = \begin{pmatrix} a+c & b+d \\ 0 & a+c \end{pmatrix} = œÅ_œµ(A+B).$

And finally for multiplication of dual numbers $(a+bœµ )(c+dœµ ) = ac+(ad+bc)œµ$:

$œÅ_œµ(A)œÅ_œµ(B) = \begin{pmatrix}a & b \\ 0 & a \end{pmatrix}\begin{pmatrix} c & d \\ 0 & c \end{pmatrix} = \begin{pmatrix} ac & ad+bc \\ 0 & ac \end{pmatrix} = œÅ_œµ(AB).$

**END**
-------

**Problem 5 (C)** What is the correct definition of division on dual numbers, i.e.,
$$
(a + b œµ )/(c + d œµ ) = s + t œµ
$$
for what choice of $s$ and $t$? Use dual numbers to compute the derivative of the following functions at $x = 0.1$:
$$
\exp(\exp x \cos x + \sin x), \prod_{k=1}^3 \left({x \over k}-1\right),\hbox{ and } f^{\rm s}_2(x) = {1 + {x - 1 \over 2 + {x-1 \over 2}}}
$$

**SOLUTION**

As with complex numbers, division is easiest to understand by first multiplying with the conjugate, that is:
$$
\frac{a+bœµ}{c+dœµ} = \frac{(a+bœµ)(c-dœµ)}{(c+dœµ)(c-dœµ)}.
$$
Expanding the products and dropping terms with $œµ^2$ then leaves us with the definition of division for dual numbers (where the denominator must have non-zero real part):
$$
\frac{a}{c} + \frac{bc - ad}{c^2}œµ.
$$ 
Thus we have $s = \frac{a}{c}$ and $t = \frac{bc - ad}{c^2}$.

We now compute the derivatives of the three functions by evaluating for $x = 0.1 + œµ$.

For the first function we have:
$$
\begin{align*}
\exp(\exp(0.1 + œµ)\cos(0.1+œµ) + \sin(0.1+œµ)) &=
\exp((\exp(0.1) + œµ\exp(0.1))(\cos(0.1)-\sin(0.1)œµ) + \sin(0.1)+\cos(0.1)œµ) \\
&= \exp(\exp(0.1)\cos(0.1)+ \sin(0.1) + (\exp(0.1)(\cos(0.1)-\sin(0.1))+\cos(0.1))œµ) \\
&= \exp(\exp(0.1)\cos(0.1)+ \sin(0.1)) + \exp(\exp(0.1)\cos(0.1)+ \sin(0.1))\exp(0.1)(\cos(0.1)-\sin(0.1))+\cos(0.1))œµ 
\end{align*}
$$
therefore the derivative is the dual part
$$
\exp(\exp(0.1)\cos(0.1)+ \sin(0.1))(\exp(0.1)(\cos(0.1)-\sin(0.1))+\cos(0.1))
$$

For the second function we have:
$$
\begin{align*}
 \left(0.1+œµ-1\right) \left({0.1 + œµ \over 2}-1\right)\left({0.1 + œµ \over 3}-1\right)
 &=\left(-0.9+œµ\right) \left(-0.95 + œµ/2\right)\left(-29/30 + œµ/3\right) \\
&=\left(171/200 -1.4œµ\right)\left(-29/30 + œµ/3\right)  \\
&= -1653/2000 + 983œµ/600
\end{align*}
$$
Thus the derivative is $983/600$.

For the third function we have:
$$
\begin{align*}
{1 + {0.1+œµ - 1 \over 2 + {0.1+œµ-1 \over 2}}} &=  {1 + {-0.9+œµ \over 1.55 + œµ/2}}\\
&= 1 -18/31 + 2œµ/1.55^2
\end{align*}
$$
Thus the derivative is $2/1.55^2$.



**END**