# MATH50003 Numerical Analysis (2022â€“23)
# Problem Sheet 7

This problem sheet concerns singular value decompositions, pseudo-inverses,
and condition numbers.

-----

For the SVD $A = U Î£ V^âŠ¤ âˆˆ â„^{m Ã— n}$, where $U âˆˆ â„^{m Ã— r}$ and $V âˆˆ â„^{n Ã— r}$ have orthonormal columns
and $Î£$ is a diagonal matrix with non-increasing positive entries, define the _pseudo-inverse_:
$$
A^+ := V Î£^{-1} U^âŠ¤.
$$

**Problem 1.1**  Show that $A^+$ satisfies the _Moore-Penrose conditions_:
1. $A A^+ A = A$
2. $A^+ A A^+ = A^+$
3. $(A A^+)^âŠ¤  = A A^+$ and $(A^+ A)^âŠ¤ = A^+ A$

**SOLUTION**

Let $A=UÎ£ V^âŠ¤$ and $A^+ := V Î£^{-1} U^âŠ¤$, where $U âˆˆ â„^{m Ã— r}$ and $V âˆˆ â„^{n Ã— r}$. Note that $U^âŠ¤U = I_m$ and $V^âŠ¤V = I_r$. 

1. We have
$$
A A^+ A = U Î£ V^âŠ¤ V Î£^{-1} U^âŠ¤ U Î£ V^âŠ¤ = U Î£ Î£^{-1} Î£ V^âŠ¤ = UÎ£ V^âŠ¤ = A
$$
2. Moreover,
$$
A^+ A A^+ = V Î£^{-1}U^âŠ¤ U Î£ V^âŠ¤ V Î£^{-1} U^âŠ¤ = V Î£^{-1}Î£ Î£^{-1} U^âŠ¤ = V Î£^{-1} U^âŠ¤ = A^+
$$
3. 
$$
\begin{align*}
(A A^+)^âŠ¤ = (A^+)^âŠ¤ A^âŠ¤ = U Î£^{-1} V^âŠ¤ V Î£ U^âŠ¤ = U U^âŠ¤ = U Î£ V^âŠ¤ V Î£^{-1} U^âŠ¤ = A A^+ \\
(A^+ A)^âŠ¤ = A^âŠ¤ (A^+)^âŠ¤ =  V Î£ U^âŠ¤ U Î£^{-1} V^âŠ¤ = V V^âŠ¤ = V Î£^{-1} U^âŠ¤ U Î£ V^âŠ¤  = A^+ A
\end{align*}
$$


**END**

**Problem 1.2** Show for $A âˆˆ â„^{m Ã— n}$ with $m â‰¥ n$ and full rank
that $ğ± =  A^+ ğ›$ is the least squares solution, i.e., minimises $\| A ğ± - ğ› \|_2$.
Hint: extend $U$ in the SVD to be a square orthogonal matrix.

**SOLUTION**

The proof mimics that of the QR factorisation. Write $A =  U Î£ V^âŠ¤$ and let
$$
UÌƒ = \begin{bmatrix}U & K \end{bmatrix}
$$
so that $UÌƒ$ is orthogonal. We use the fact orthogonal matrices do not change norms:
$$
\begin{align*}
\|A ğ± - ğ› \|_2^2 &= \|U Î£ V^âŠ¤ ğ± - ğ› \|_2^2 = \|UÌƒ^âŠ¤ U Î£ V^âŠ¤ ğ± - UÌƒ^âŠ¤ ğ› \|_2^2 = 
\|\underbrace{\begin{bmatrix}I_m \\ O \end{bmatrix}}_{âˆˆ â„^{m Ã— n}} Î£ V^âŠ¤ ğ± - \begin{bmatrix} U^âŠ¤ \\ K^âŠ¤ \end{bmatrix} ğ› \|_2^2 \\
&= \|Î£ V^âŠ¤ ğ± - U^âŠ¤ ğ› \|_2^2 + \|K^âŠ¤ ğ›\|^2
\end{align*}
$$
The second term is independent of $ğ±$. The first term is minimised when zero:
$$
 \|Î£ V^âŠ¤ ğ± - U^âŠ¤ ğ› \|_2 =\|Î£ V^âŠ¤ V Î£^{-1} U^âŠ¤ ğ›  - U^âŠ¤ ğ› \|_2 = 0
$$

**END**

**Problem 1.3**
If $A âˆˆ â„^{m Ã— n}$ has a non-empty kernel there are multiple solutions to the least
squares problem as 
we can add any element of the kernel. Show that $ğ± = A^+ ğ›$ gives the least squares solution
such that $\| ğ± \|_2$ is minimised.

**SOLUTION**

Let $ğ±     =A^+b$ and let $ğ± + ğ¤$ to be another solution i.e.
$$
\|Ağ± - b \| = \|A (ğ± +ğ¤) - b \|
$$
Following the previous part we deduce:
$$
Î£ V^âŠ¤ (ğ± +ğ¤) = U^âŠ¤ ğ› â‡’ V^âŠ¤ ğ¤ = 0
$$
As $ğ± = V ğœ$ lies in the span of the columns of $V$ we have
$ğ±^âŠ¤ ğ¤ = 0$. Thus
$$
\| ğ± + ğ¤ \|^2 = \| ğ± \|^2 + \| ğ¤ \|^2
$$
which is minimised when $ğ¤ = 0$.

**END**


------



**Problem 2** Compute the 1-norm, 2-norm, and âˆ-norm condition numbers for the following matrices:
$$
\begin{bmatrix}
1 & 2 \\ 3 & 4
\end{bmatrix}, \begin{bmatrix}
1/3 & 1/5 \\ 0 & 1/7
\end{bmatrix}, \begin{bmatrix} 1 \\ & 1/2 \\ && â‹± \\ &&& 1/2^n \end{bmatrix}
$$
Hint: recall that the singular values of a matrix $A$ are the square roots of the eigenvalues of the Gram matrix
$A^âŠ¤A$.

**SOLUTION**

$$
A=\begin{bmatrix}
1 & 2 \\ 3 & 4
\end{bmatrix},\qquad
A^{-1}=-\frac{1}{2}\begin{bmatrix}
4 & -2 \\ -3 & 1
\end{bmatrix}
$$

$$
B=\begin{bmatrix}
1/3 & 1/5 \\ 0 & 1/7
\end{bmatrix},\qquad
B^{-1}=21\begin{bmatrix}
1/7 & -1/5 \\ 0 & 1/3
\end{bmatrix}
$$

$\|A\|_1=6$, $\|A^{-1}\|_1=7/2$, so $Îº_1(A)=21$.

$\|A\|_âˆ=7$, $\|A^{-1}\|_âˆ=3$, so $Îº_âˆ(A)=21$.

$\|B\|_1=12/35$, $\|B^{-1}\|_1=21\times 8/15=56/5$, so $Îº_1(B)=96/25$.

$\|B\|_âˆ=8/15$, $\|B^{-1}\|_âˆ=21\times 12/35$, so $Îº_âˆ(B)=96/25$

Finally, for the $2$-norms: $Îº_2(A)$:
For $A =  \begin{bmatrix}
1 & 2 \\
3 & 4
\end{bmatrix}$, we have that the singular values are the $Ïƒ_1 = \sqrt{Î»_1}, Ïƒ_2 = \sqrt{Î»_2}$, where $Î»_1$ and $Î»_2$ are the eigenvalues of $A^âŠ¤A$.
$$
A^âŠ¤A =   \begin{bmatrix}
10 & 14 \\
14 & 20
\end{bmatrix},
$$
so an eigenvalue $Î»$ of $A^âŠ¤ A$ must satisfy,
$$
\begin{align*}
(10 - Î»)(20-Î») - 196 = 0 \\
â‡” Î» = 15 \pm\sqrt{221}.
\end{align*}
$$
The larger eigenvalue corresponds to $Ïƒ_1$, so $Ïƒ_1 = \sqrt{15  + \sqrt{221}}$, and the smaller corresponds to $Ïƒ_2$, so $Ïƒ_2 = \sqrt{15  - \sqrt{221}}$. Finally, we have $\|A\|_2 = Ïƒ_1, \|A^{-1}\|_2 = 1/Ïƒ_2$, and so $Îº_2(A) = \sqrt{\frac{15  + \sqrt{221}}{15  - \sqrt{221}}}$.

 $Îº_2(B)$:
For 
$$
B =   \begin{bmatrix}
1/3 & 1/5 \\
0 & 1/7
\end{bmatrix},
$$
we have that the singular values are the $Ïƒ_1 = \sqrt{Î»_1}, Ïƒ_2 = \sqrt{Î»_2}$, where $Î»_1$ and $Î»_2$ are the eigenvalues of $A^âŠ¤A$.
$$
A^âŠ¤A =   \begin{bmatrix}
1/9 & 1/15 \\
1/15 & \frac{74}{5^27^2}
\end{bmatrix}.
$$
An eigenvalue $Î»$ must satisfy:
\begin{align*}
(1/9 - Î») â‰¤ \left(\frac{74}{5^27^2}-Î»\right) - \frac{1}{225} = 0 \\
â‡” Î» = \frac{1891 \pm29\sqrt{2941}}{22050}.
\end{align*}
With the same logic as above, we can then deduce that
$$
\|B\|_2 = \sqrt{\frac{1891 +29\sqrt{2941}}{22050}}
$$
and
$$
\|B^{-1}\|_2 \sqrt{\frac{22050}{1891 -29\sqrt{2941}}}
$$
so that,
$$
Îº_2(B) = \sqrt{\frac{1891 +29\sqrt{2941}}{1891 -29\sqrt{2941}}}
$$

For,
$$
A_n =   \begin{bmatrix}1 \\ &1/2 \\&&â‹± \\&&&1/2^n \end{bmatrix},\hspace{5mm}
A_n^{-1} =   \begin{bmatrix}1 \\ &2 \\&&â‹± \\&&&2^n \end{bmatrix}
$$
It is clear that
$$
\|A_n\|_1 = \|A_n\|_âˆ = 1,
$$
and
$$
\|A_n^{-1}\|_1 = \|A_n^{-1}\|_âˆ = 2^n,
$$
so $Îº_1(A_n) = Îº_âˆ(A) = 2^n$.
Morover, we can clearly see the singular values $Ïƒ_1 = 1, Ïƒ_2 = 1/2, â€¦, Ïƒ_{n+1} = 1/2^n$. So $\|A_n\|_2 = 1, \|A_n^{-1}\|_2 = 2^n$, $Îº_2(A_n) = 2^n$

**END**





--------

**Problem 3.1**
For $U âˆˆ â„^{n Ã— n}$, an upper triangular matrix such that the diagonal are all 1 ($u_{kk} = 1$)
and all entries are floats, 
show that backsubstitution implemented with floating point has a backward error formula:
$$
{\tt backsubstitution}(U, ğ›) = (U+Î´U)^{-1} (ğ› + Î´ğ›).
$$
Assuming $n Ïµ_{\rm m} < 2$ and all operations are in the
normalised range, show that
$$
\begin{align*}
|Î´b_k| &â‰¤ {Ïµ_{\rm m} \over 2} |b_k| \\
|Î´u_{k,j}| &â‰¤ E_{n-k+1,Ïµ_{\rm m}/2} |u_{k,j}|\qquad\hbox{for $j > k$} \\
|Î´u_{k,j}| &= 0 \qquad \hbox{for $j â‰¤ k$}
\end{align*}
$$
Hint: Note that if we write $ğ±Ìƒ = {\tt backsubstitution}(U, ğ›)$ then we have
$$
xÌƒ_k = b_k âŠ– {\tt dot}(U[k,k+1:n], ğ±Ìƒ[k+1:n]).
$$
You may then use II.7 Lemma 1. Further, note that if $|Î¸_k| â‰¤ E_{k,Îµ}$ and $|Î´| â‰¤ Îµ$  then
$|(1+Î¸_k) (1+Î´) - 1| â‰¤ E_{k+1,Îµ}$.


**SOLUTION**

For $ğ± = U^{-1} ğ›$ and $ğ±Ìƒ = {\tt backsubstitution}(U, ğ›)$, note $x_n = xÌƒ_n = b_n$. we have:
$$
xÌƒ_{n-1} = b_{n-1} âŠ– (u_{n-1,n} âŠ— xÌƒ_n) = (b_{n-1} - (u_{n-1,n}  xÌƒ_n) (1+Î´_1))(1 + Î´_2)
=b_{n-1} (1+Î´_2) - u_{n-1,n} (1+Î´_1) (1+Î´_2)  xÌƒ_n
$$
Hence $Î´b = b_{n-1}Î´_2$ and $Î´U[n-1,n] = u_{n-1,n} Î¸_2$.

Write $ğ®_k := U[k,k+1:n]$ and $ğ›_k = ğ›[k+1:n]$. Note from Lemma 1 in lectures we have 
$$
{\tt dot}(ğ®_k, ğ›_k) = (ğ®_k + Î´ğ®_k)^âŠ¤ğ›_k
$$
where $|Î´ğ®_k| â‰¤ E_{n-k,Ïµ_{\rm m}/2} |ğ®_k|$.
Thus we find
$$
xÌƒ_k = b_k âŠ– {\tt dot}(ğ®_k, ğ›_k) = (b_k - ((ğ®_k + Î´ğ®_k)^âŠ¤ ğ±Ìƒ[k+1:n]))(1+Î´_k) 
= b_k + Î´_k b_k  - (ğ®_k + Î´_k ğ®_k + Î´ğ®_k (1+Î´_k))^âŠ¤ ğ±Ìƒ[k+1:n]).
$$
where from II.7 Lemma 1 we know
$$
\begin{align*}
ğ_1^âŠ¤ Î´ğ®_k = Î¸Ìƒ_{n-k} u_{k,k+1} \\
ğ_j^âŠ¤ Î´ğ®_k = Î¸_{n-k-j} u_{k,k+j}\qquad\hbox{for $j > 1$}.
\end{align*}
$$
In other words, we have:
$$
ğ±Ìƒ = (U+Î´U)^{-1} (ğ› + Î´ğ›)
$$
where for $j=k$ we have
$$
|Î´u_{k,k+1}| = |Î´_k u_{k,k+1} +  u_{k,k+1} Î¸Ìƒ_{n-k} (1+Î´_k)| â‰¤ 
|u_{k,k+1}| |(1+Î¸Ìƒ_{n-k}) (1+Î´_k)-1| â‰¤Â |u_{k,k+1}| E_{n-k+1,Ïµ_{\rm m}/2}
$$
since $(1+Î¸Ìƒ_{n-k}) (1+Î´_k)$ is precisely a product of $n-k+1$ terms.
Similarly, for $j > k+1$ we have
$$
|Î´u_{k,j}| â‰¤  |u_{k,j}| |(1+Î¸_{n-j+2}) (1+Î´_k)-1| â‰¤Â |u_{k,j}| E_{n-j+3,Ïµ_{\rm m}/2}
â‰¤Â |u_{k,j}| E_{n-k+1,Ïµ_{\rm m}/2}.
$$
**END**

**Problem 3.2** Show that 
$$
\begin{align*}
\|Î´U\|_1 &â‰¤  E_{n,Ïµ_{\rm m}/2} \|U \|_1 \\
\|Î´U\|_2 &â‰¤  \sqrt{n} E_{n,Ïµ_{\rm m}/2} \|U \|_2 \\
\|Î´U\|_âˆ &â‰¤  E_{n,Ïµ_{\rm m}/2} \|U \|_âˆ
\end{align*}
$$

**SOLUTION**

This is identical to the proof of II.7 Corollary 1 after observing that
$$
|Î´u_{k,j}| â‰¤ E_{n,Ïµ_{\rm m}/2} |u_{k,j}|.
$$

**END**
